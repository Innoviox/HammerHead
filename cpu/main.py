import cpu
import tabulate as tb
import time

def write_state_to_file(c, moves, racks, times, file='run.txt'):
    s=''
    h = ['Turn', 'Word', 'Score', 'Eval', 'Pos', 'Rack', 'Time']
    t=[]
    
    for i,m in enumerate(moves,start=1):
        t.append([i,cpu.skips_formatted(m), m.score, m.valuation, (m.row, m.col), racks[i-1], times[i-1]])
    s += tb.tabulate(t,headers=h,tablefmt="fancy_grid")
    s+='\n'
    s += c.displayBoard(c.board)
    f = open(file,'w',encoding='utf-8')
    f.write(s)
    f.close()
    
c = cpu.CPU()
ms=[]
rs=[]
ts=[]
racks = ["ITIATWE", "ITMDEXY", "TYAUAOU", "UAURAEF", "UFOLOIT", "LITUCKE"]
i = 0
while c.distribution:
    c.rack = list(racks[i])
    rs.append(''.join(c.rack))
    t=time.time()
    ms.append(c._run())
    c.board.updateCrosschecks(ms[-1])
    ts.append(round(time.time()-t, 2))
    write_state_to_file(c, ms, rs, ts)
    print(open('run.txt').read())
    i += 1
    #input()
    
'''
╒════════╤════════╤═════════╤════════╤═════════╤═════════╤════════╕
│   Turn │ Word   │   Score │   Eval │ Pos     │ Rack    │   Time │
╞════════╪════════╪═════════╪════════╪═════════╪═════════╪════════╡
│      1 │ TAWIE  │      18 │   0.11 │ (4, 8)  │ ITIATWE │   0.48 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      2 │ MIXED  │      41 │  -1.66 │ (7, 9)  │ ITMDEXY │   5.58 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      3 │ OATY   │      25 │ -17.35 │ (6, 7)  │ TYAUAOU │   1.75 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      4 │ AURAE  │      12 │  -6.56 │ (9, 6)  │ UAURAEF │   2.21 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      5 │ FOU    │      19 │   0.02 │ (13, 7) │ UFOLOIT │   6.6  │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      6 │ KITE   │      35 │  -2.11 │ (5, 10) │ LITUCKE │  13.42 │
╘════════╧════════╧═════════╧════════╧═════════╧═════════╧════════╛

╒════════╤════════╤═════════╤════════╤═════════╤═════════╤════════╕
│   Turn │ Word   │   Score │   Eval │ Pos     │ Rack    │   Time │
╞════════╪════════╪═════════╪════════╪═════════╪═════════╪════════╡
│      1 │ TAWIE  │      18 │   0.11 │ (4, 8)  │ ITIATWE │   0.48 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      2 │ MIXED  │      41 │  -1.66 │ (7, 9)  │ ITMDEXY │   5.61 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      3 │ OATY   │      25 │ -17.35 │ (6, 7)  │ TYAUAOU │   1.69 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      4 │ AURAE  │      12 │  -6.56 │ (9, 6)  │ UAURAEF │   2.26 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      5 │ FOU    │      19 │   0.02 │ (13, 7) │ UFOLOIT │   6.51 │
├────────┼────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      6 │ KITE   │      35 │  -2.11 │ (5, 10) │ LITUCKE │  13.57 │
╘════════╧════════╧═════════╧════════╧═════════╧═════════╧════════╛

╒════════╤═══════════╤═════════╤════════╤═════════╤═════════╤════════╕
│   Turn │ Word      │   Score │   Eval │ Pos     │ Rack    │   Time │
╞════════╪═══════════╪═════════╪════════╪═════════╪═════════╪════════╡
│      1 │ TAWIE     │      18 │   0.11 │ (4, 8)  │ ITIATWE │   0.49 │
├────────┼───────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      2 │ MIXED     │      41 │  -1.66 │ (7, 9)  │ ITMDEXY │   4.76 │
├────────┼───────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      3 │ OATY      │      25 │ -17.35 │ (6, 7)  │ TYAUAOU │   1.66 │
├────────┼───────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      4 │ AURAE     │      12 │  -6.56 │ (9, 6)  │ UAURAEF │   2.22 │
├────────┼───────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      5 │ FOU       │      19 │   0.02 │ (13, 7) │ UFOLOIT │   6.53 │
├────────┼───────────┼─────────┼────────┼─────────┼─────────┼────────┤
│      6 │ T(R)UCKLE │      52 │  -1.49 │ (11, 5) │ LITUCKE │  13.43 │
╘════════╧═══════════╧═════════╧════════╧═════════╧═════════╧════════╛
'''